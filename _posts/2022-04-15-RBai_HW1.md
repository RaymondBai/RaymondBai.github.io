---
layout: post
title: HW1 - Data Wrangling and Visualization
---

## Key Imports
```python
import pandas as pd
import sqlite3
from plotly import express as px
from sklearn.linear_model import LinearRegression
```

## Getting Data and Creating a database
We will directly get and store the Palmer Penguin data set from Prof. Chodrow's Github page.
```python
# Read in the temperature df
temps = pd.read_csv("temps_stacked.csv")
# Read in the countries df
countries = pd.read_csv('countries.csv')
# Read in the stations df directly from url
url = "https://raw.githubusercontent.com/PhilChodrow/PIC16B/master/datasets/noaa-ghcn/station-metadata.csv"
stations = pd.read_csv(url)

# Substitute white space for underscore in df column names
countries = countries.rename(columns= {"FIPS 10-4": "FIPS_10_4"})
countries = countries.rename(columns= {"ISO 3166": "ISO_3166"})
```

```python
# Create and connect to a temps.db database
conn = sqlite3.connect("temps.db")

# Add the three tables to temps.db
temps.to_sql("temperatures", conn, if_exists="replace", index=False)
stations.to_sql("stations", conn, if_exists="replace", index=False)
countries.to_sql("countries", conn, if_exists="replace", index=False)

# close your connection after database construction
conn.close()
```

## Query Function

```python
def query_climate_database(country, year_begin, year_end, month):
    # Connect to the database
    conn = sqlite3.connect("temps.db")
    # SQL command for joining the tables and returning the desired columns
    cmd = '''
    SELECT
        s.NAME, s.LATITUDE, s.LONGITUDE, c.Name Country, t.Year, t.Month, t.Temp
    FROM
        temperatures t
    LEFT JOIN stations s ON t.ID = s.ID
    LEFT JOIN countries c ON SUBSTR(t.ID, 1, 2) = c.FIPS_10_4
    '''
    # Execute the SQL command and store the queried data into df
    df = pd.read_sql_query(cmd, conn)
    conn.close()
    # Return entries that follow user specifications
    return df.loc[(df.Country == country) & (df.Month == month) &
                  (df.Year >= year_begin) & (df.Year <= year_end)].reset_index().drop('index', axis = 1)
```

## Data Visualization

```python
# The four columns that will be used in the visualization
cols = ['Culmen Length (mm)', 'Flipper Length (mm)',
        'Body Mass (g)', "Species"]
# Plotting pairplot with custom color palette for species
sns.pairplot(penguins[cols], hue = "Species", height = 3,
             palette = {"Adelie":"#1f77b5",
                        "Chinstrap":"#2ba02b",
                        "Gentoo":"#e05c54"}
            )
```
![image-example.png](/images/visualization.png)

